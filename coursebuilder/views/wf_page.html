{% extends 'base.html' %}
{% block top_content %}
{% include "notifications_area.html" %}
{% endblock %}
{% block main_content %}
{% if editor_role == 'admin' and editing %}
<center><div id="alerts-bar">You are editing someone else's page, as an admin.</div></center>
{% endif %}
{% if alert %}
<center><div id="alerts-bar">{{ alert }}</div></center>
{% endif %}
<script src="assets/lib/jquery-ui-1.10.3.custom/js/jquery-ui-1.10.3.custom.min.js"></script>
<link rel="stylesheet" href="assets/lib/jquery-ui-1.10.3.custom/css/booc-theme/jquery-ui-1.10.3.custom.min.css">
<style>
  div#exemplary-text {
    display: none;
  }
  a.collapser {
    
  }
</style>
<div class="gcb-aux">
  <div class="gcb-cols">
    <div class="gcb-col-11 wiki-area">
      <div id="wiki-title-and-edit">
        {% if unit %}
        <h1>Unit {{ unit.unit_id }} - {{ unit.title | safe }} <small class="wiki-unit-link">
            <a href="unit?unit={{ unit.unit_id }}">(prompt)</a></small></h1>
        {% endif %}
        <div>
          {% if editor_role and can_do_assignments and not editing %}
          <a class="gcb-button"
            href="{{action_url('edit')}}">edit</a>
          {% if editor_role != 'author' %} as {{ editor_role }}{% endif %}
          {% endif %}
        </div>
      </div>
      <div>by {{ student_link(author) }}</div>
      {% if editing %}
      <form action="{{ action_url('save') }}" method="POST" id="wiki-form">
        <input type="hidden" name="xsrf_token" value="{{ create_xsrf_token('save') }}">
        {% endif %}
        {% block wiki_content %}
        {% endblock %}
        {% if editing %}
        <br>
        <input type="submit" name="Save" value="Save" class="gcb-button">
      </form>
      {% endif %}
    </div>
  </div>
  <div class="gcb-cols">
    <div id="assignment-completion" class="gcb-col-11 gcb-aside">
      <div id="endorsements" class="gcb-col-5">
        {% for e in endorsements %}
        {% if loop.first %}This page has been endorsed as complete by{% endif %}
        {% if loop.last and not loop.first %} and {% endif %}
        <a href="wikiprofile?student={{ e.who.wiki_id }}">{{ e.who.name }}</a>{% if not loop.last%},{%endif%}
        {% else %}
        <b>This page has not yet been marked as complete.</b>
        {% endfor %}
        <br>
        {% if endorsement_view != 'author' %}
        <form action="{{ action_url('endorse') }}" method="POST">
          <input type="hidden" name="xsrf_token" value="{{ create_xsrf_token('endorse') }}">
          {% if endorsement_view == 'has_endorsed' %}
          You have marked this page as complete.  You can
          <input type="submit" name="undo" class="gcb-button" value="undo"> the endorsement.
          {% elif endorsement_view == 'can_endorse' %}
          Click here to endorse that the author has completed
          <input type="submit" name="required_done" class="gcb-button" value="the required parts">, or
          <input type="submit" name="all_done" class="gcb-button" value="the required AND optional parts"> of the assignment.
          {% endif %}
        </form>
        {% endif %}
      </div>
      <div id="exemplaries" class="gcb-col-5">
        {% if exemplary_view == 'can_exemplary' %}
        You can mark this page as exemplary!<br>
        <form action="{{ action_url('exemplary') }}" method="POST">
          <input type="hidden" name="xsrf_token" value="{{ create_xsrf_token('exemplary') }}">
          <textarea name="comment" style="width: 100%" rows="2" placeholder="This is great because..."></textarea><br>
          <input type="submit" class="gcb-button" value="&#9733; Exemplary">
        </form>
        {% elif exemplary_view == 'has_exemplaried' %}
        You have marked this page as exemplary.
        {% endif %}
        {% for e in exemplaries %}
        {% if loop.first %}<span style="float:left; font-size: 2em; color: #fc0;">&#9733;</span> This page has been marked as exemplary by{% endif %}
        {% if loop.last and not loop.first %} and {% endif %}
        {{ student_link(e.who) }}{% if not loop.last%},{%endif%}
        {% if loop.last %}
        <br><a onclick="$('div#exemplary-text').toggle()">Show reasons</a><br>
        {% endif %}
        {% else %}<!-- no exemplaries -->
        {% endfor %}
        <div id="exemplary-text">
          {% for e in exemplaries %}
          {{ student_link(e.who) }} says: {{ e.reason | safe }}
          {% endfor %}
        </div>
      </div>
    </div>

  </div>
  {% include "comment_area.html" %}
  <center><a onclick="$(this).next().toggle()" style="color: #c33;">Flag inappropriate content</a>
    <div id="flag-form" style="display: none;">
      <form action="{{ action_url('flag') }}" method="POST">
        <input type="hidden" name="xsrf_token" value="{{ create_xsrf_token('flag') }}">
        You can alert an instructor regarding inappropriate content on this page:<br>
        <input size="60" name="reason"></input>
        <input type="submit" value="Report">
      </form>
    </div>
  </center>
</div>
<script src="/assets/lib/Placeholders.min.js"></script>
{% if editing %}
<script src="/assets/ckeditor/ckeditor.js"></script>
<script src="/assets/ckeditor/adapters/jquery.js"></script>
<script>
  $(document).ready( function() {
    $('#wiki-form textarea').ckeditor({
      allowedContent: '{{ ckeditor_allowed_content }}'
    });
  });
</script>
{% endif %}
{% endblock %}
